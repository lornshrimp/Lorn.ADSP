# 后台管理运营系统需求文档

## 项目概述

后台管理运营系统是Lorn.ADSP开源广告平台的核心基础设施模块，专注于为广告系统提供必要的用户管理、权限控制、组织架构管理以及统一的管理门户等关键功能。该系统设计简洁高效，避免复杂的OA流程，专门服务于广告系统的业务需求。

### 系统定位

- **专注广告业务**：专门为广告系统提供必要的用户和权限管理功能
- **简洁高效**：避免复杂的审批流程和工作流，专注核心CRUD操作和权限验证
- **开源友好**：轻量级设计，易于部署和维护，高度可扩展的权限控制系统

### 核心价值

- 为广告系统提供统一的权限验证和用户管理服务
- 支持广告业务相关的角色和权限控制
- 简化的组织架构管理，服务于权限分配
- 统一的管理门户界面和各业务模块的宿主平台

## 需求列表

### 需求1：组织架构管理

**用户故事：** 作为系统管理员，我希望能够管理简化的组织架构，包括基础的部门层级和岗位设置，以便为广告系统的权限分配提供组织基础。

#### 验收标准

1. WHEN 管理员创建部门时 THEN 系统应当支持最多5级的部门层次结构创建
2. WHEN 管理员设置岗位时 THEN 系统应当支持创建独立的岗位并定义基本岗位信息
3. WHEN 管理员配置岗位部门关系时 THEN 系统应当支持岗位与部门的多对多关系，一个岗位可以属于多个部门，一个部门可以有多个岗位
4. WHEN 管理员调整组织架构时 THEN 系统应当支持部门的移动操作但不支持复杂的合并拆分
5. WHEN 组织架构发生变更时 THEN 系统应当自动调整相关人员的部门归属关系
6. WHEN 删除部门时 THEN 系统应当检查是否存在关联人员，有关联人员的部门不能删除
7. WHEN 删除岗位时 THEN 系统应当检查是否存在关联人员，有关联人员的岗位不能删除
8. WHEN 查询组织架构时 THEN 系统应当提供树形结构的部门展示和快速搜索功能
9. WHEN 管理岗位时 THEN 系统应当支持岗位的启用、禁用状态管理和岗位部门关系的维护

### 需求2：管理运营人员管理

**用户故事：** 作为人事管理员，我希望能够管理广告系统后台管理运营人员的基本信息和账户状态，以便为权限管理提供用户基础数据。

#### 验收标准

1. WHEN 管理员添加新用户时 THEN 系统应当记录用户名、真实姓名、邮箱、手机号、所属部门和担任岗位信息
2. WHEN 管理员配置用户组织关系时 THEN 系统应当支持用户与部门的多对多关系，用户可以属于多个部门，同时可以担任多个岗位
3. WHEN 管理员修改用户信息时 THEN 系统应当记录变更历史但不需要复杂的审批流程
4. WHEN 用户离职时 THEN 系统应当支持账户禁用、软删除并保留历史记录
5. WHEN 用户调岗时 THEN 系统应当更新其组织关系，包括部门归属和岗位变更，权限需要手动重新分配
6. WHEN 查询用户信息时 THEN 系统应当支持按用户名、姓名、部门、岗位、状态等条件进行筛选
7. WHEN 批量管理用户时 THEN 系统应当支持Excel导入导出、批量状态变更等操作
8. WHEN 管理用户密码时 THEN 系统应当支持管理员重置密码和用户首次登录强制修改密码
9. WHEN 用户账户异常时 THEN 系统应当支持账户锁定、解锁和状态查询功能
10. WHEN 管理用户组织关系时 THEN 系统应当支持用户部门关系和岗位关系的独立管理和维护

### 需求3：权限管理系统

**用户故事：** 作为权限管理员，我希望能够灵活配置权限规则，支持基础的权限委派和Deny优先策略，以便为广告系统各业务模块提供精细化的权限控制。

#### 验收标准

1. WHEN 管理员定义权限时 THEN 系统应当支持按模块、功能、操作三个层级定义权限项，并支持权限分类管理
2. WHEN 分配权限时 THEN 系统应当支持直接分配给用户、通过角色分配、通过组织分配三种方式
3. WHEN 设置权限策略时 THEN 系统应当支持Allow和Deny两种权限类型，且Deny权限优先生效
4. WHEN 进行权限委派时 THEN 系统应当支持基础的权限委派功能，设置委派期限，无需复杂审批流程
5. WHEN 权限冲突时 THEN 系统应当按照Deny优先、直接权限优先于继承权限的规则处理
6. WHEN 业务模块调用权限接口时 THEN 系统应当提供RESTful API和gRPC两种接口形式进行权限验证
7. WHEN 管理数据权限时 THEN 系统应当支持全部数据、部门数据、个人数据、自定义数据等权限类型
8. WHEN 权限验证时 THEN 系统应当在10ms内完成权限验证，支持权限缓存和实时更新机制
9. WHEN 权限变更时 THEN 系统应当记录完整的权限操作审计日志和变更历史

### 需求4：角色管理系统

**用户故事：** 作为权限管理员，我希望能够创建和管理各种角色，通过角色来简化权限分配工作，以便提高广告系统权限管理效率。

#### 验收标准

1. WHEN 管理员创建角色时 THEN 系统应当支持定义角色名称、描述、类型和权限集合
2. WHEN 分配角色时 THEN 系统应当支持单角色分配、多角色分配和批量角色分配
3. WHEN 修改角色权限时 THEN 系统应当自动更新所有拥有该角色用户的权限并清理相关缓存
4. WHEN 角色继承时 THEN 系统应当支持角色间的继承关系，限制继承深度不超过5层，避免循环继承
5. WHEN 删除角色时 THEN 系统应当检查角色使用情况，有用户关联的角色不能删除
6. WHEN 配置角色权限时 THEN 系统应当支持权限模板应用、批量权限配置和权限预览功能
7. WHEN 角色权限计算时 THEN 系统应当支持递归继承计算、权限合并策略和权限缓存优化
8. WHEN 管理角色生命周期时 THEN 系统应当支持角色创建、维护、退役的完整生命周期管理

### 需求5：统一认证登录

**用户故事：** 作为管理运营人员，我希望能够通过统一的登录入口访问系统，并享受安全可靠的身份验证服务，以便安全地使用各项管理功能。

#### 验收标准

1. WHEN 用户登录时 THEN 系统应当支持用户名密码登录，预留LDAP、OAuth、SSO等第三方认证接口
2. WHEN 登录验证时 THEN 系统应当检查账户状态、密码策略、登录失败次数和IP限制
3. WHEN 登录成功时 THEN 系统应当生成安全的会话令牌、记录登录日志并在500ms内完成登录过程
4. WHEN 会话管理时 THEN 系统应当支持会话超时设置、空闲超时、绝对超时和会话销毁机制
5. WHEN 密码管理时 THEN 系统应当支持密码复杂度策略、管理员重置密码和密码安全保护
6. WHEN 账户安全管理时 THEN 系统应当支持登录失败锁定、账户状态管理和安全监控
7. WHEN 安全控制时 THEN 系统应当支持验证码机制、IP限制和并发登录控制
8. WHEN 会话监控时 THEN 系统应当支持活跃会话查询、异常会话检测和会话统计分析

### 需求6：管理门户界面

**用户故事：** 作为管理运营人员，我希望有一个统一的管理门户，能够访问所有相关的管理功能和业务模块，以便高效地完成日常管理工作。

#### 验收标准

1. WHEN 用户登录门户时 THEN 系统应当根据用户权限显示可访问的菜单和功能，支持个人工作台和快捷入口
2. WHEN 导航菜单时 THEN 系统应当支持多级菜单结构、快速搜索功能和面包屑导航
3. WHEN 访问业务模块时 THEN 系统应当支持模块间的无缝跳转、统一用户体验和模块动态加载
4. WHEN 个人设置时 THEN 系统应当支持用户修改个人信息、密码、界面偏好和个性化配置
5. WHEN 系统通知时 THEN 系统应当支持实时消息推送、待办提醒、系统公告和消息处理功能
6. WHEN 界面个性化时 THEN 系统应当支持主题切换、色彩配置、布局调整和多语言界面
7. WHEN 菜单管理时 THEN 系统应当支持业务模块动态注册菜单、菜单权限控制和菜单版本管理
8. WHEN 业务模块集成时 THEN 系统应当提供模块宿主功能、统一界面风格和模块间通信机制

### 需求7：审计日志系统

**用户故事：** 作为安全管理员，我希望系统能够记录所有关键操作的审计日志，以便进行安全审计、问题追溯和合规检查。

#### 验收标准

1. WHEN 用户操作时 THEN 系统应当记录用户登录登出、功能访问、数据操作和权限使用的详细日志
2. WHEN 系统运行时 THEN 系统应当记录系统启动停止、配置变更、服务调用和异常事件的日志
3. WHEN 管理操作时 THEN 系统应当记录用户管理、权限管理、角色管理和组织架构变更的操作日志
4. WHEN 安全事件发生时 THEN 系统应当记录认证安全、授权安全和数据安全相关的事件
5. WHEN 广告业务操作时 THEN 系统应当记录广告管理、投放管理和数据操作的审计信息
6. WHEN 查询日志时 THEN 系统应当支持时间范围、用户、操作类型等多条件查询和统计分析
7. WHEN 存储日志时 THEN 系统应当支持日志存储策略配置、自动清理和数据归档管理
8. WHEN 安全监控时 THEN 系统应当支持实时安全事件监控、异常检测和告警机制

### 需求8：系统配置管理

**用户故事：** 作为系统管理员，我希望能够统一管理系统的各类配置参数和业务规则，以便适应不同的业务场景和安全要求。

#### 验收标准

1. WHEN 管理系统配置时 THEN 系统应当支持数据库配置、缓存配置、消息队列配置等基础配置管理
2. WHEN 配置安全策略时 THEN 系统应当支持密码策略、登录策略、会话策略和权限策略的配置
3. WHEN 配置广告业务时 THEN 系统应当支持投放规则、计费规则、质量控制等业务配置
4. WHEN 配置界面显示时 THEN 系统应当支持主题配置、菜单配置、字典配置和多语言配置
5. WHEN 管理配置环境时 THEN 系统应当支持开发、测试、预生产、生产等多环境配置管理
6. WHEN 配置版本控制时 THEN 系统应当支持配置版本管理、变更历史记录和版本回滚功能
7. WHEN 动态更新配置时 THEN 系统应当支持配置热更新、更新策略控制和更新影响控制
8. WHEN 配置安全管理时 THEN 系统应当支持访问权限控制、敏感信息保护和操作审计记录

### 需求9：权限接口服务

**用户故事：** 作为业务模块开发者，我希望能够通过标准化的权限接口获取用户权限信息，以便在各个业务模块中实现统一的权限控制。

#### 验收标准

1. WHEN 业务模块调用权限接口时 THEN 系统应当提供RESTful API和gRPC两种接口形式
2. WHEN 权限验证时 THEN 系统应当支持单个权限验证、批量权限验证和数据权限查询
3. WHEN 获取用户信息时 THEN 系统应当提供用户基本信息、角色信息和权限列表
4. WHEN 权限缓存时 THEN 系统应当支持权限信息缓存、实时更新机制和缓存一致性保证
5. WHEN 接口监控时 THEN 系统应当提供接口调用统计、性能监控和异常告警
6. WHEN 权限管理时 THEN 系统应当支持分配权限、回收权限、委派权限和权限查询接口
7. WHEN 业务模块集成时 THEN 系统应当支持权限定义注册、权限更新通知和权限依赖管理
8. WHEN 权限验证集成时 THEN 系统应当提供统一权限验证入口、权限装饰器和权限中间件

### 需求10：消息通知系统

**用户故事：** 作为管理运营人员，我希望能够及时接收到系统通知和业务消息，以便及时处理相关事务和了解系统状态。

#### 验收标准

1. WHEN 系统产生消息时 THEN 系统应当支持系统通知、业务通知、审批通知、安全通知等多种消息类型
2. WHEN 推送消息时 THEN 系统应当支持基于WebSocket的实时推送、离线消息存储和消息优先级处理
3. WHEN 处理消息时 THEN 系统应当支持消息查看、标记、回复、转发和删除功能
4. WHEN 发布公告时 THEN 系统应当支持公告创建、审核、发布、置顶和权限控制
5. WHEN 公告展示时 THEN 系统应当支持公告分类、有效期设置和阅读统计功能
6. WHEN 消息管理时 THEN 系统应当支持消息分类展示、筛选搜索和批量操作
7. WHEN 通知设置时 THEN 系统应当支持用户个人通知偏好设置和通知方式配置
8. WHEN 消息监控时 THEN 系统应当支持消息推送状态监控、消息统计分析和异常告警