# 角色管理模块产品需求

## 模块概述

角色管理模块是权限管理体系的重要组成部分，通过角色的概念简化权限分配和管理工作。该模块支持灵活的角色定义、角色继承、角色权限配置等功能，为广告系统权限管理提供高效的角色化解决方案。专注于核心角色功能，避免复杂的审批流程。

## 核心功能需求

### 5.1 角色定义管理

#### 5.1.1 角色基本信息
- **角色名称**：角色的中文显示名称
- **角色编码**：全局唯一的角色标识符
- **角色描述**：详细的角色职责和功能描述
- **角色类型**：系统角色、业务角色、临时角色等
- **所属模块**：角色归属的业务模块或系统模块
- **角色状态**：启用、禁用状态

#### 5.1.2 角色分类管理
- **系统管理角色**：系统管理员、安全管理员等
- **业务管理角色**：广告管理员、运营主管等
- **操作执行角色**：广告专员、客服人员等
- **临时角色**：项目角色、临时授权角色等
- **只读角色**：只读访问权限的角色

#### 5.1.3 角色操作功能
- **创建角色**：创建新的角色
- **编辑角色**：修改角色基本信息
- **删除角色**：删除不再使用的角色
- **复制角色**：基于现有角色创建新角色
- **启用/禁用角色**：控制角色的使用状态

### 5.2 角色权限配置

#### 5.2.1 权限集合管理
- **功能权限配置**：为角色配置功能操作权限
- **数据权限配置**：为角色配置数据访问权限
- **接口权限配置**：为角色配置API接口权限
- **菜单权限配置**：为角色配置菜单访问权限

#### 5.2.2 权限模板应用
- **预定义模板**：使用预定义的权限模板
- **自定义模板**：创建自定义权限模板
- **模板继承**：从其他角色或模板继承权限
- **模板保存**：将当前权限配置保存为模板

#### 5.2.3 权限配置操作
- **权限选择**：选择要分配给角色的权限
- **权限类型设置**：设置Allow或Deny权限
- **批量权限配置**：批量配置多个权限
- **权限预览**：预览权限配置结果

### 5.3 角色继承管理

#### 5.3.1 继承关系定义
- **父子角色关系**：定义角色间的父子继承关系
- **继承权限范围**：定义继承的权限范围
- **继承优先级**：设置不同继承来源的优先级
- **继承条件设置**：设置角色继承的条件和限制

#### 5.3.2 继承规则管理
- **完全继承**：子角色完全继承父角色的所有权限
- **部分继承**：子角色只继承父角色的部分权限
- **增量继承**：子角色在继承基础上增加额外权限
- **覆盖继承**：子角色可以覆盖父角色的某些权限

#### 5.3.3 继承冲突处理
- **继承冲突检测**：检测角色继承中的权限冲突
- **冲突解决策略**：定义权限冲突的解决策略
- **继承链验证**：验证角色继承链的有效性
- **循环继承防护**：防止角色继承中的循环依赖

### 5.4 角色分配管理

#### 5.4.1 用户角色分配
- **单角色分配**：为用户分配单个角色
- **多角色分配**：为用户分配多个角色
- **角色分配期限**：设置角色分配的有效期限
- **分配原因记录**：记录角色分配的原因

#### 5.4.2 批量角色分配
- **批量用户分配**：为多个用户批量分配角色
- **部门角色分配**：为整个部门分配角色
- **岗位角色分配**：为特定岗位分配角色
- **条件角色分配**：根据条件自动分配角色

#### 5.4.3 角色分配监控
- **分配记录跟踪**：跟踪角色分配的完整记录
- **分配统计分析**：统计分析角色分配情况
- **到期提醒**：角色分配到期的提醒
- **自动回收**：到期角色的自动回收

### 5.5 角色生命周期管理

#### 5.5.1 角色创建
- **角色需求分析**：分析角色创建的业务需求
- **角色设计**：设计角色的权限和职责
- **角色创建**：在系统中创建角色
- **权限配置**：配置角色的权限
- **角色测试**：测试角色的功能和权限

#### 5.5.2 角色维护
- **角色监控**：监控角色的使用情况
- **权限调整**：根据需要调整角色权限
- **角色优化**：优化角色的权限配置
- **角色更新**：更新角色的信息和权限

#### 5.5.3 角色退役
- **退役评估**：评估角色退役的影响
- **用户迁移**：将用户迁移到其他角色
- **权限回收**：回收角色相关权限
- **角色禁用**：禁用不再使用的角色

## 数据模型设计

### 5.6 角色基本信息数据模型

```
角色表 (Role)
├── 角色ID (RoleId) - 主键
├── 角色编码 (RoleCode) - 唯一编码
├── 角色名称 (RoleName) - 角色名称
├── 角色描述 (Description) - 角色描述
├── 角色类型 (RoleType) - 角色类型枚举
├── 所属模块 (ModuleId) - 外键
├── 角色状态 (Status) - 状态枚举
├── 是否系统角色 (IsSystemRole) - 是否系统角色
├── 排序号 (SortOrder) - 排序号
├── 创建时间 (CreatedTime) - 创建时间
├── 更新时间 (UpdatedTime) - 更新时间
├── 创建人ID (CreatedBy) - 创建人
└── 最后修改人ID (LastModifiedBy) - 最后修改人
```

### 5.7 角色权限关联数据模型

```
角色权限表 (RolePermission)
├── 角色权限ID (RolePermissionId) - 主键
├── 角色ID (RoleId) - 外键
├── 权限ID (PermissionId) - 外键
├── 权限类型 (PermissionType) - Allow/Deny
├── 权限来源 (Source) - 直接配置/继承/模板
├── 来源ID (SourceId) - 来源对象ID
├── 生效时间 (EffectiveTime) - 生效时间
├── 失效时间 (ExpiryTime) - 失效时间
├── 配置原因 (ConfigReason) - 配置原因
├── 配置人ID (ConfiguredBy) - 配置人
├── 权限状态 (Status) - 状态枚举
├── 创建时间 (CreatedTime) - 创建时间
└── 更新时间 (UpdatedTime) - 更新时间
```

### 5.8 角色继承关系数据模型

```
角色继承表 (RoleInheritance)
├── 继承ID (InheritanceId) - 主键
├── 父角色ID (ParentRoleId) - 外键
├── 子角色ID (ChildRoleId) - 外键
├── 继承类型 (InheritanceType) - 继承类型枚举
├── 继承范围 (InheritanceScope) - 继承范围
├── 继承优先级 (Priority) - 继承优先级
├── 继承条件 (InheritanceCondition) - 继承条件
├── 生效时间 (EffectiveTime) - 生效时间
├── 失效时间 (ExpiryTime) - 失效时间
├── 继承状态 (Status) - 状态枚举
├── 创建时间 (CreatedTime) - 创建时间
├── 更新时间 (UpdatedTime) - 更新时间
└── 创建人ID (CreatedBy) - 创建人
```

### 5.9 用户角色分配数据模型

```
用户角色表 (UserRole)
├── 用户角色ID (UserRoleId) - 主键
├── 用户ID (UserId) - 外键
├── 角色ID (RoleId) - 外键
├── 分配类型 (AssignmentType) - 直接分配/自动分配
├── 分配原因 (AssignmentReason) - 分配原因
├── 生效时间 (EffectiveTime) - 生效时间
├── 失效时间 (ExpiryTime) - 失效时间
├── 分配人ID (AssignedBy) - 分配人
├── 分配状态 (Status) - 状态枚举
├── 创建时间 (CreatedTime) - 创建时间
└── 更新时间 (UpdatedTime) - 更新时间
```

### 5.10 角色权限模板数据模型

```
权限模板表 (PermissionTemplate)
├── 模板ID (TemplateId) - 主键
├── 模板编码 (TemplateCode) - 唯一编码
├── 模板名称 (TemplateName) - 模板名称
├── 模板描述 (Description) - 模板描述
├── 模板类型 (TemplateType) - 模板类型枚举
├── 适用角色类型 (ApplicableRoleType) - 适用角色类型
├── 模板内容 (TemplateContent) - JSON格式的权限配置
├── 模板版本 (Version) - 模板版本
├── 是否默认模板 (IsDefault) - 是否默认模板
├── 模板状态 (Status) - 状态枚举
├── 创建时间 (CreatedTime) - 创建时间
├── 更新时间 (UpdatedTime) - 更新时间
└── 创建人ID (CreatedBy) - 创建人
```

## 用户界面设计

### 5.11 角色管理主界面

#### 5.11.1 角色列表页面
- **角色列表展示**：以表格形式展示所有角色
- **角色搜索筛选**：支持角色名称、类型等搜索筛选
- **角色状态显示**：显示角色的当前状态
- **快速操作**：提供编辑、删除、禁用等快速操作

#### 5.11.2 角色详情页面
- **基本信息展示**：显示角色的基本信息
- **权限配置展示**：显示角色的权限配置
- **用户分配情况**：显示分配了该角色的用户
- **继承关系图**：显示角色的继承关系

### 5.12 角色权限配置界面

#### 5.12.1 权限配置页面
- **权限树形结构**：以树形结构展示可配置的权限
- **权限选择操作**：支持权限的选择和取消选择
- **权限批量操作**：支持权限的批量选择和配置
- **权限预览功能**：预览权限配置的结果

#### 5.12.2 权限模板页面
- **模板列表展示**：显示可用的权限模板
- **模板应用操作**：应用权限模板到角色
- **模板自定义**：创建和编辑自定义权限模板
- **模板管理**：管理权限模板的生命周期

### 5.13 角色分配管理界面

#### 5.13.1 用户角色分配页面
- **用户选择**：选择需要分配角色的用户
- **角色选择**：选择需要分配的角色
- **分配预览**：预览角色分配的结果
- **批量分配**：支持批量角色分配操作

#### 5.13.2 角色分配监控页面
- **分配统计**：统计角色分配的情况
- **分配历史**：查看角色分配的历史记录
- **到期监控**：监控即将到期的角色分配
- **使用分析**：分析角色的使用情况

## 角色权限计算

### 5.14 权限计算规则

#### 5.14.1 基本计算规则
- **直接权限优先**：直接分配给角色的权限优先
- **继承权限补充**：继承的权限作为补充
- **Deny权限优先**：拒绝权限优先于允许权限
- **时间有效性**：只计算有效时间内的权限

#### 5.14.2 继承权限计算
- **递归继承计算**：递归计算多层继承的权限
- **继承优先级**：按优先级合并继承的权限
- **继承冲突处理**：处理继承中的权限冲突
- **继承深度限制**：限制继承的最大深度

#### 5.14.3 权限合并策略
- **权限并集**：合并所有允许权限
- **权限交集**：只保留共同权限
- **权限差集**：排除特定权限
- **自定义合并**：根据业务规则自定义合并

### 5.15 权限缓存优化

#### 5.15.1 角色权限缓存
- **角色权限预计算**：预计算角色的有效权限
- **权限计算缓存**：缓存权限计算结果
- **增量更新缓存**：权限变更时增量更新缓存
- **缓存一致性**：保证缓存与数据库的一致性

#### 5.15.2 用户权限缓存
- **用户权限聚合**：聚合用户的所有角色权限
- **权限快照缓存**：缓存用户权限快照
- **实时权限更新**：角色权限变更时实时更新用户权限
- **缓存失效策略**：合理的缓存失效策略

## 业务规则

### 5.16 角色管理规则

#### 5.16.1 角色创建规则
- 角色编码必须唯一
- 角色名称必须唯一
- 系统角色不能被删除
- 角色创建需要记录操作日志

#### 5.16.2 角色权限配置规则
- 只能配置已启用的权限
- Deny权限优先于Allow权限
- 权限配置变更立即生效
- 权限变更需要记录操作日志

#### 5.16.3 角色继承规则
- 不能形成循环继承
- 继承深度不超过5层
- 子角色不能拥有比父角色更高的权限
- 继承关系变更需要重新计算权限

### 5.17 角色分配规则

#### 5.17.1 分配基本规则
- 只能分配已启用的角色
- 用户可以拥有多个角色
- 角色分配需要记录操作日志
- 角色分配变更立即生效

#### 5.17.2 分配限制规则
- 系统管理员角色需要特殊权限才能分配
- 临时角色必须设置有效期
- 禁用用户不能分配新角色
- 角色分配数量可以设置限制

## 系统集成接口

### 5.18 角色管理接口

#### 5.18.1 角色信息接口
- **获取角色列表**：获取指定条件的角色列表
- **获取角色详情**：根据角色ID获取详细信息
- **创建角色**：创建新的角色
- **更新角色**：更新角色信息
- **删除角色**：删除指定角色

#### 5.18.2 角色权限接口
- **获取角色权限**：获取角色的权限列表
- **配置角色权限**：配置角色的权限
- **计算有效权限**：计算角色的有效权限
- **权限变更通知**：角色权限变更通知

#### 5.18.3 角色分配接口
- **分配用户角色**：为用户分配角色
- **取消用户角色**：取消用户的角色分配
- **获取用户角色**：获取用户的角色列表
- **批量角色操作**：批量角色分配和取消

### 5.19 外部系统集成

#### 5.19.1 权限系统集成
- **权限同步**：与权限系统的角色权限同步
- **权限验证**：提供角色权限验证服务
- **权限变更通知**：角色权限变更的通知机制

#### 5.19.2 用户系统集成
- **用户角色查询**：为用户系统提供角色查询
- **角色验证服务**：提供角色验证服务
- **用户变更通知**：用户变更时的角色处理

## 技术实现要求

### 5.20 性能要求

#### 5.20.1 响应时间
- **角色查询**：< 100ms
- **权限计算**：< 50ms
- **角色分配**：< 200ms
- **批量操作**：根据数据量合理设置

#### 5.20.2 并发支持
- **并发用户**：1000+
- **角色权限计算QPS**：5000+
- **数据一致性**：强一致性
- **缓存命中率**：> 90%

### 5.21 安全要求

#### 5.21.1 角色安全
- **角色权限加密**：敏感角色权限加密存储
- **访问控制**：严格的角色访问控制
- **操作审计**：完整的角色操作审计
- **权限泄露防护**：防止角色权限信息泄露

#### 5.21.2 数据安全
- **角色数据隔离**：不同角色的数据隔离
- **敏感角色保护**：敏感角色的特殊保护
- **角色变更监控**：角色变更的实时监控
- **异常告警**：角色异常的告警机制